<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simultane Ã‡eviri (Web, Tek Dosya)</title>
  <style>
    :root{--bg:#0f172a;--card:#111827;--muted:#94a3b8;--text:#e5e7eb;--accent:#22c55e;--danger:#ef4444;--warn:#f59e0b}
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";background:var(--bg);color:var(--text)}
    .wrap{max-width:960px;margin:0 auto;padding:20px}
    .title{font-size:clamp(20px,3.5vw,36px);font-weight:800;letter-spacing:.2px;margin:4px 0 14px}
    .subtitle{color:var(--muted);margin-bottom:16px}
    .grid{display:grid;gap:14px}
    @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.04),rgba(255,255,255,0.02));border:1px solid rgba(148,163,184,.18);border-radius:18px;padding:14px 14px 10px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    label{font-size:12px;color:var(--muted)}
    select,input[type="text"],input[type="password"],input[type="url"],textarea{background:#0b1220;border:1px solid rgba(148,163,184,.3);color:var(--text);padding:10px 12px;border-radius:12px;outline:none;width:100%}
    select:focus,input:focus,textarea:focus{border-color:#60a5fa;box-shadow:0 0 0 3px rgba(96,165,250,.15)}
    button{appearance:none;border:none;border-radius:14px;padding:12px 14px;font-weight:700;cursor:pointer;transition:.18s transform ease,.18s opacity ease;display:inline-flex;gap:8px;align-items:center}
    button:hover{transform:translateY(-1px)}
    .primary{background:var(--accent);color:#001a09}
    .danger{background:var(--danger);color:white}
    .ghost{background:#0b1220;color:#cbd5e1;border:1px solid rgba(148,163,184,.3)}
    .warn{background:var(--warn);color:#1f1300}
    .pill{font-size:12px;padding:6px 10px;border-radius:999px;background:#0b1220;border:1px solid rgba(148,163,184,.25);color:#cbd5e1}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    .flex-1{flex:1}
    .stack{display:flex;flex-direction:column;gap:8px}
    .note{font-size:12px;color:var(--muted)}
    .badge{font-size:11px;background:#0b1220;color:#a0aec0;border:1px solid rgba(148,163,184,.3);border-radius:10px;padding:4px 8px}
    .logs{height:140px;overflow:auto;white-space:pre-wrap;background:#0b1220;border:1px solid rgba(148,163,184,.3);border-radius:12px;padding:10px}
    .transcript{min-height:80px}
    .level{height:8px;border-radius:999px;background:#0b1220;border:1px solid rgba(148,163,184,.25);overflow:hidden}
    .level > i{display:block;height:100%;width:6%;background:linear-gradient(90deg, rgba(96,165,250,.8), rgba(34,197,94,.8));transition:width .08s ease}
    .cols{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .muted{opacity:.8}
    .footer{margin-top:16px;font-size:12px;color:var(--muted)}
    .kbd{font-weight:700;border:1px solid rgba(148,163,184,.4);padding:1px 6px;border-radius:6px;background:#0b1220}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="title">Simultane Ã‡eviri</div>
    <div class="subtitle">Telefonunuzda tek dosya <span class="badge">index.html</span> olarak Ã§alÄ±ÅŸÄ±r. Mikrofonu dinler, yazÄ±ya dÃ¶ker, seÃ§ilen saÄŸlayÄ±cÄ±yla Ã§evirir ve hedef dilde <em>sesli</em> okur.</div>

    <div class="card stack">
      <div class="row">
        <div class="stack" style="min-width:220px;flex:1">
          <label>Ã‡eviri SaÄŸlayÄ±cÄ±sÄ±</label>
          <select id="provider">
            <option value="none">(Ã‡eviri olmadan â€“ test)</option>
            <option value="libre">LibreTranslate / uyumlu API</option>
            <option value="deepl">DeepL API</option>
            <option value="openai">OpenAI (Chat Completions)</option>
          </select>
          <div class="note">TarayÄ±cÄ±dan doÄŸrudan API Ã§aÄŸrÄ±sÄ± bazÄ± saÄŸlayÄ±cÄ±larda CORS nedeniyle Ã§alÄ±ÅŸmayabilir. Gerekirse kendi <span class="mono">/proxy</span> uÃ§ noktanÄ±zÄ± kullanÄ±n.</div>
        </div>
        <div class="stack flex-1" id="libreBox" style="display:none">
          <label>LibreTranslate UÃ§ NoktasÄ±</label>
          <input type="url" id="libreEndpoint" placeholder="https://libretranslate.com/translate" />
        </div>
        <div class="stack flex-1" id="deeplBox" style="display:none">
          <label>DeepL API AnahtarÄ±</label>
          <input type="password" id="deeplKey" placeholder="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx:fx" />
        </div>
        <div class="stack flex-1" id="openaiBox" style="display:none">
          <label>OpenAI API AnahtarÄ±</label>
          <input type="password" id="openaiKey" placeholder="sk-..." />
        </div>
      </div>
      <div class="row">
        <div class="stack" style="min-width:220px;flex:1">
          <label>Benim Dilim (Kaynak)</label>
          <select id="sourceLang"></select>
        </div>
        <div class="stack" style="min-width:220px;flex:1">
          <label>KarÅŸÄ± TarafÄ±n Dili (Hedef)</label>
          <select id="targetLang"></select>
        </div>
        <div class="stack" style="min-width:200px;flex:1">
          <label>Hedef Ses (Okunacak Ses)</label>
          <select id="voiceSelect"></select>
          <div class="note">Ses seÃ§enekleri cihazdaki <em>SpeechSynthesis</em> seslerine gÃ¶re listelenir.</div>
        </div>
      </div>
      <div class="row">
        <button id="startBtn" class="primary">â–¶ BaÅŸlat</button>
        <button id="stopBtn" class="ghost">â–  Durdur</button>
        <button id="flipBtn" class="ghost" title="Kaynak â†” Hedef dillerini deÄŸiÅŸtir">â†”ï¸ Dilleri DeÄŸiÅŸtir</button>
        <span id="status" class="pill">HazÄ±r</span>
        <span id="warn" class="pill" style="display:none;background:#0b1220;border-color:#f59e0b;color:#fbbf24">iOS Safari, web'de tanÄ±mayÄ± sÄ±nÄ±rlayabilir</span>
      </div>
      <div class="row" style="align-items:flex-end">
        <div class="stack flex-1">
          <label>Ben SÃ¶ylerken (TanÄ±ma)</label>
          <div id="myTranscript" class="logs transcript"></div>
          <div class="level"><i id="lvl"></i></div>
          <div class="row">
            <button id="pttMe" class="ghost" title="Bas-KonuÅŸ">ğŸ™ï¸ Bas & KonuÅŸ</button>
            <button id="copyMy" class="ghost">Kopyala</button>
            <span class="note">KÄ±sa cÃ¼mleler ve duraklamalar tanÄ±mayÄ± hÄ±zlandÄ±rÄ±r.</span>
          </div>
        </div>
        <div class="stack flex-1">
          <label>KarÅŸÄ± Tarafa Okunan (Ã‡eviri + TTS)</label>
          <div id="toOther" class="logs transcript"></div>
          <div class="row">
            <button id="testSay" class="ghost">ğŸ”Š Test Oku</button>
            <button id="copyOther" class="ghost">Kopyala</button>
          </div>
        </div>
      </div>
    </div>

    <div class="card stack">
      <div class="row" style="justify-content:space-between;align-items:flex-start">
        <div class="stack" style="max-width:680px">
          <strong>Ä°ki YÃ¶nlÃ¼ (Backâ€‘toâ€‘Back) Mod</strong>
          <div class="note">KarÅŸÄ± taraf konuÅŸurken ayrÄ± bir butona basÄ±p Ã§evirisini kendi dilinizde dinleyin. AynÄ± anda iki tanÄ±ma oturumu tarayÄ±cÄ±larda Ã§akÄ±ÅŸabileceÄŸi iÃ§in <em>basâ€‘konuÅŸ</em> yaklaÅŸÄ±mÄ± daha kararlÄ±dÄ±r.</div>
        </div>
        <div><span class="badge">Opsiyonel</span></div>
      </div>

      <div class="row" style="align-items:flex-end">
        <div class="stack flex-1">
          <label>KarÅŸÄ± KiÅŸi SÃ¶ylerken (TanÄ±ma â€“ Hedef Dilde)</label>
          <div id="otherTranscript" class="logs transcript"></div>
          <div class="row">
            <button id="pttOther" class="ghost">ğŸ™ï¸ KarÅŸÄ± Taraf KonuÅŸsun</button>
            <button id="copyOtherSrc" class="ghost">Kopyala</button>
          </div>
        </div>
        <div class="stack flex-1">
          <label>Sana Okunan (Ã‡eviri + TTS)</label>
          <div id="toMe" class="logs transcript"></div>
          <div class="row">
            <button id="testSayMe" class="ghost">ğŸ”Š Test Oku</button>
            <button id="copyToMe" class="ghost">Kopyala</button>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">
      <div>âš ï¸ <strong>Gizlilik/Ãœcret:</strong> SeÃ§tiÄŸiniz API'ye gÃ¶nderilen metinler saÄŸlayÄ±cÄ±nÄ±za iletilir. Mobil tarayÄ±cÄ±da doÄŸrudan anahtar kullanÄ±mÄ± iÃ§in kendi CORS proxy'nizi Ã¶neririz.</div>
      <div>ğŸ’¡ <strong>Ä°pucu:</strong> Ana ekrana ekleyerek (PWA olmadan) hÄ±zlÄ± baÅŸlatabilirsiniz. Diller ve anahtarlar yerelde saklanÄ±r.</div>
    </div>
  </div>

<script>
(function(){
  const $ = (s)=>document.querySelector(s);
  const $$ = (s)=>Array.from(document.querySelectorAll(s));
  const els = {
    provider: $('#provider'), libreBox: $('#libreBox'), deeplBox: $('#deeplBox'), openaiBox: $('#openaiBox'),
    libreEndpoint: $('#libreEndpoint'), deeplKey: $('#deeplKey'), openaiKey: $('#openaiKey'),
    sourceLang: $('#sourceLang'), targetLang: $('#targetLang'), voiceSelect: $('#voiceSelect'),
    startBtn: $('#startBtn'), stopBtn: $('#stopBtn'), flipBtn: $('#flipBtn'), status: $('#status'), warn: $('#warn'),
    myTranscript: $('#myTranscript'), toOther: $('#toOther'), lvl: $('#lvl'), pttMe: $('#pttMe'), copyMy: $('#copyMy'), copyOther: $('#copyOther'),
    otherTranscript: $('#otherTranscript'), toMe: $('#toMe'), pttOther: $('#pttOther'), copyOtherSrc: $('#copyOtherSrc'), copyToMe: $('#copyToMe'),
    testSay: $('#testSay'), testSayMe: $('#testSayMe'),
  };

  const SUPPORTED_LANGS = [
    {code:'tr-TR', name:'TÃ¼rkÃ§e'}, {code:'en-US', name:'Ä°ngilizce (ABD)'}, {code:'en-GB', name:'Ä°ngilizce (UK)'},
    {code:'de-DE', name:'Almanca'}, {code:'fr-FR', name:'FransÄ±zca'}, {code:'es-ES', name:'Ä°spanyolca'}, {code:'it-IT', name:'Ä°talyanca'},
    {code:'ru-RU', name:'RusÃ§a'}, {code:'ar-SA', name:'ArapÃ§a'}, {code:'fa-IR', name:'FarsÃ§a'}, {code:'el-GR', name:'Yunanca'},
    {code:'bg-BG', name:'Bulgarca'}, {code:'ro-RO', name:'Romence'}, {code:'nl-NL', name:'FlemenkÃ§e'}, {code:'pt-PT', name:'Portekizce'},
    {code:'hi-IN', name:'HintÃ§e'}, {code:'ja-JP', name:'Japonca'}, {code:'ko-KR', name:'Korece'}, {code:'zh-CN', name:'Ã‡ince (BasitleÅŸtirilmiÅŸ)'}
  ];

  function fillLangs(){
    els.sourceLang.innerHTML = SUPPORTED_LANGS.map(l=>`<option value="${l.code}">${l.name}</option>`).join('');
    els.targetLang.innerHTML = SUPPORTED_LANGS.map(l=>`<option value="${l.code}">${l.name}</option>`).join('');
    const s = localStorage.getItem('sim-src') || 'tr-TR';
    const t = localStorage.getItem('sim-tgt') || 'en-US';
    els.sourceLang.value = s; els.targetLang.value = t;
  }

  function saveSettings(){
    localStorage.setItem('sim-provider', els.provider.value);
    localStorage.setItem('sim-libre', els.libreEndpoint.value||'');
    localStorage.setItem('sim-deepl', els.deeplKey.value||'');
    localStorage.setItem('sim-openai', els.openaiKey.value||'');
    localStorage.setItem('sim-src', els.sourceLang.value);
    localStorage.setItem('sim-tgt', els.targetLang.value);
    localStorage.setItem('sim-voice', els.voiceSelect.value||'');
  }

  function loadSettings(){
    els.provider.value = localStorage.getItem('sim-provider') || 'none';
    els.libreEndpoint.value = localStorage.getItem('sim-libre') || 'https://libretranslate.com/translate';
    els.deeplKey.value = localStorage.getItem('sim-deepl') || '';
    els.openaiKey.value = localStorage.getItem('sim-openai') || '';
  }

  function uiProvider(){
    els.libreBox.style.display = els.provider.value==='libre' ? '' : 'none';
    els.deeplBox.style.display = els.provider.value==='deepl' ? '' : 'none';
    els.openaiBox.style.display = els.provider.value==='openai' ? '' : 'none';
  }

  // Speech Synthesis Voices
  let voices = [];
  function populateVoices(){
    voices = speechSynthesis.getVoices();
    const options = voices.map(v=>{
      const label = `${v.name} â€“ ${v.lang}${v.default?' (varsayÄ±lan)':''}`;
      return `<option value="${v.name}" data-lang="${v.lang}">${label}</option>`;
    }).join('');
    els.voiceSelect.innerHTML = `<option value="">(Otomatik â€“ hedef dile en yakÄ±n)</option>` + options;
    const saved = localStorage.getItem('sim-voice');
    if(saved) els.voiceSelect.value = saved;
  }
  speechSynthesis.onvoiceschanged = populateVoices;

  // Mic level (simple analyser)
  let mediaStream, audioCtx, analyser, dataArray;
  async function setupLevel(){
    try{
      mediaStream = await navigator.mediaDevices.getUserMedia({audio:true});
      audioCtx = new (window.AudioContext||window.webkitAudioContext)();
      const source = audioCtx.createMediaStreamSource(mediaStream);
      analyser = audioCtx.createAnalyser();
      analyser.fftSize = 256; dataArray = new Uint8Array(analyser.frequencyBinCount);
      source.connect(analyser);
      raf();
    }catch(err){/* mic level optional */}
  }
  function raf(){
    if(!analyser) return; analyser.getByteFrequencyData(dataArray);
    const avg = dataArray.reduce((a,b)=>a+b,0)/dataArray.length; // 0..255
    const w = Math.min(100, Math.max(2, (avg/255)*100));
    els.lvl.style.width = w+'%';
    requestAnimationFrame(raf);
  }

  // Speech Recognition helper
  function createRecognizer(lang){
    const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
    if(!SR) return null;
    const r = new SR();
    r.continuous = false; r.interimResults = true; r.lang = lang;
    return r;
  }

  // Translation providers
  async function translateText(text, from, to){
    const provider = els.provider.value;
    if(!text || from===to || provider==='none') return text; // passthrough

    if(provider==='libre'){
      const ep = (els.libreEndpoint.value||'').trim();
      const body = {q:text, source: from.split('-')[0], target: to.split('-')[0], format:'text'};
      const res = await fetch(ep,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
      if(!res.ok) throw new Error('LibreTranslate hata: '+res.status);
      const js = await res.json();
      return js.translatedText || js.translation || text;
    }

    if(provider==='deepl'){
      const key = (els.deeplKey.value||'').trim();
      const res = await fetch('https://api-free.deepl.com/v2/translate',{method:'POST',headers:{'Authorization':'DeepL-Auth-Key '+key,'Content-Type':'application/x-www-form-urlencoded'},body:new URLSearchParams({text:text, target_lang: to.split('-')[0].toUpperCase()})});
      if(!res.ok) throw new Error('DeepL hata: '+res.status);
      const js = await res.json();
      return (js.translations && js.translations[0] && js.translations[0].text) || text;
    }

    if(provider==='openai'){
      const key = (els.openaiKey.value||'').trim();
      const payload = {
        model: 'gpt-4o-mini',
        messages: [
          {role:'system', content:'You are a translation engine. Translate the user input preserving meaning and tone. Output only the translated text.'},
          {role:'user', content:`From ${from} to ${to}. Text: ${text}`}
        ],
        temperature: 0.2
      };
      const res = await fetch('https://api.openai.com/v1/chat/completions',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+key},body:JSON.stringify(payload)});
      if(!res.ok) throw new Error('OpenAI hata: '+res.status);
      const js = await res.json();
      const out = js.choices?.[0]?.message?.content?.trim();
      return out || text;
    }

    return text;
  }

  function say(text, targetLang){
    if(!text) return;
    const u = new SpeechSynthesisUtterance(text);
    const pickedName = els.voiceSelect.value;
    if(pickedName){
      const v = voices.find(v=>v.name===pickedName);
      if(v) u.voice = v;
    } else {
      // try pick a voice with same language prefix
      const pref = targetLang.split('-')[0];
      const v = voices.find(v=>v.lang && v.lang.toLowerCase().startsWith(pref));
      if(v) u.voice = v;
    }
    u.lang = (u.voice?.lang)||targetLang;
    // speechSynthesis.cancel(); // iptal kaldÄ±rÄ±ldÄ±
    speechSynthesis.speak(u);
  }

  // Main flow (Me -> Other)
  let recMe = null; let activeMe = false; let lastChunkMe = '';
  function startMe(){
    if(activeMe) return; activeMe = true; els.status.textContent = 'Dinleniyorâ€¦';
    const lang = els.sourceLang.value;
    recMe = createRecognizer(lang);
    if(!recMe){ alert('TarayÄ±cÄ±nÄ±zda KonuÅŸma TanÄ±ma desteklenmiyor. Chrome/Edge Android Ã¶nerilir.'); els.status.textContent='Destek yok'; activeMe = false; return; }
    let interim=''; let final='';
    recMe.onresult = async (ev)=>{
      interim='';
      for(let i=ev.resultIndex;i<ev.results.length;i++){
        const res = ev.results[i];
        if(res.isFinal){
          const chunk = (res[0].transcript||'').trim();
          if(chunk && chunk !== lastChunkMe){
            lastChunkMe = chunk; // yeni cÃ¼mle
            final += chunk + ' ';
            try{
              const out = await translateText(chunk, els.sourceLang.value, els.targetLang.value);
              els.toOther.textContent = (els.toOther.textContent ? (els.toOther.textContent + ' ') : '') + out;
              say(out, els.targetLang.value);
            }catch(err){ els.toOther.textContent = (els.toOther.textContent||'') + ` [Ã§eviri hatasÄ±: ${err.message}]`; }
          }
        } else {
          interim += res[0].transcript + ' ';
        }
      }
      els.myTranscript.textContent = (final + (interim?(' '+interim):'')).trim();
    };
    recMe.onerror = (e)=>{ els.status.textContent='Hata: '+e.error; activeMe=false; };
    recMe.onend = ()=>{ if(activeMe){ try{ recMe.start(); }catch{} } };
    try{ recMe.start(); }catch{ /* sometimes throws if already started */ }
  }
  function stopMe(){ activeMe=false; try{ recMe && recMe.stop(); }catch{} els.status.textContent='Durdu'; }

  // PTT
  let pttDown = false;
  els.pttMe.addEventListener('mousedown', ()=>{ if(!activeMe){ startMe(); } pttDown=true; });
  els.pttMe.addEventListener('mouseup', ()=>{ pttDown=false; stopMe(); });
  els.pttMe.addEventListener('touchstart', (e)=>{ e.preventDefault(); if(!activeMe){ startMe(); } pttDown=true; });
  els.pttMe.addEventListener('touchend', (e)=>{ e.preventDefault(); pttDown=false; stopMe(); });

  // Other -> Me flow (manual PTT on target language)
  let recOther=null, activeOther=false, lastChunkOther='';
  function startOther(){
    if(activeOther) return; activeOther=true;
    const lang = els.targetLang.value;
    recOther = createRecognizer(lang);
    if(!recOther){ alert('KonuÅŸma TanÄ±ma desteklenmiyor.'); activeOther=false; return; }
    recOther.onresult = async (ev)=>{
      let interim=''; let final='';
      for(let i=ev.resultIndex;i<ev.results.length;i++){
        const res = ev.results[i];
        if(res.isFinal){
          const chunk = (res[0].transcript||'').trim();
          if(chunk && chunk !== lastChunkOther){
            lastChunkOther = chunk;
            final += chunk + ' ';
            try{
              const out = await translateText(chunk, els.targetLang.value, els.sourceLang.value);
              els.toMe.textContent = (els.toMe.textContent ? (els.toMe.textContent + ' ') : '') + out;
              say(out, els.sourceLang.value);
            }catch(err){ els.toMe.textContent = (els.toMe.textContent||'') + ` [Ã§eviri hatasÄ±: ${err.message}]`; }
          }
        } else {
          interim += res[0].transcript + ' ';
        }
      }
      $('#otherTranscript').textContent = (final + (interim?(' '+interim):'')).trim();
    };
    recOther.onend = ()=>{ if(activeOther){ try{ recOther.start(); }catch{} } };
    try{ recOther.start(); }catch{}
  }
  function stopOther(){ activeOther=false; try{ recOther && recOther.stop(); }catch{} }

  els.pttOther.addEventListener('mousedown', ()=>{ startOther(); });
  els.pttOther.addEventListener('mouseup', ()=>{ stopOther(); });
  els.pttOther.addEventListener('touchstart', (e)=>{ e.preventDefault(); startOther(); });
  els.pttOther.addEventListener('touchend', (e)=>{ e.preventDefault(); stopOther(); });

  // Buttons
  els.startBtn.onclick = ()=>{ saveSettings(); startMe(); };
  els.stopBtn.onclick = ()=>{ stopMe(); stopOther(); };
  els.flipBtn.onclick = ()=>{
    const s = els.sourceLang.value, t = els.targetLang.value; els.sourceLang.value=t; els.targetLang.value=s; saveSettings();
  };
  els.testSay.onclick = ()=>{ say('Hello! This is a test voice for the other side.', els.targetLang.value); };
  els.testSayMe.onclick = ()=>{ say('Merhaba! Bu ses denemesidir.', els.sourceLang.value); };

  // Copy helpers
  function copyText(id){ const t = $(id).textContent||''; navigator.clipboard?.writeText(t); }
  els.copyMy.onclick = ()=>copyText('#myTranscript');
  els.copyOther.onclick = ()=>copyText('#toOther');
  els.copyOtherSrc.onclick = ()=>copyText('#otherTranscript');
  els.copyToMe.onclick = ()=>copyText('#toMe');

  // Provider UI and persistence
  els.provider.onchange = ()=>{ uiProvider(); saveSettings(); };
  ['libreEndpoint','deeplKey','openaiKey'].forEach(id=>{ els[id].addEventListener('change', saveSettings); els[id].addEventListener('blur', saveSettings); });
  els.sourceLang.onchange = saveSettings; els.targetLang.onchange = saveSettings; els.voiceSelect.onchange = saveSettings;

  // Init
  fillLangs(); loadSettings(); uiProvider(); populateVoices(); setupLevel();

  // iOS Safari warning
  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || (navigator.platform==='MacIntel' && navigator.maxTouchPoints>1);
  if(isIOS) els.warn.style.display='inline-flex';
})();
</script>
</body>
</html>
